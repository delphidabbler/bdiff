# BDiff / BPatch Tests

This directory contains a set of tests of _BDiff_ and _BPatch_. They are run by calling `Test.bat` with various command line parameters.

## Requirements

1. `Test.bat` must be run from a command line console which has its current directory set to the directory that contains `Test.bat`.

2. Files named `Test1` and `Test2` must be located in the same directory as `Test.bat`. `Test1` and `Test2` must be different versions of the same file. Two sample files are provided. ***Do not modify `Test1` and `Test2`***.

3. `Test.bat` must be able to find the copies of `BDiff.exe` and `BPatch.exe` that it is to test. By default they are expected to be in the `..\_build\exe` directory relative to the directory where `Test.bat` is located.

    If the programs are not in `..\_build\exe` then the `BDIFFPATH` environment variable must be set to the directory that contains both programs. Do not include a backslash at the end of the path.

4. Files `Diff-b`, `Diff-f` and `Diff-q` must be in the test directory and ***must not be modified***. These files are used to check for the expected output from `test patch`, `test quoted` and `test filtered`, respectively. The tests will fail if these files or `Test1` or `Test2` have been modified.

## Tests

### Patching test

Run the test by entering the command: 

    Test.bat patch
    
BDiff is run on `Test1` and `Test2` and creates a binary diff file named `Patch`. BPatch then applies `Patch` to `Test1` to create `Test3`, which should be identical to `Test2`. The Windows FC command is used to verify that `Test2` and `Test3` are in fact the same and that `Patch` is as expected (it must be the same as `Diff-p`).

### Quoted format diff test

Run the test by entering the command: 

    Test.bat quoted

or

    Test.bat quoted view
    
BDiff is run on `Test1` and `Test2` and creates a quoted text diff file named `Diff` that is compared against the expected content in `Diff-q`. If the optional `view` parameter is provided `Diff` is displayed in NotePad.

### Filtered format diff test

Run the test by entering the command: 

    Test.bat filtered
    
or

    Test.bat filtered view

BDiff is run on `Test1` and `Test2` and creates a filtered text diff file named `Diff` that is compared against the expected content in `Diff-f`. If the optional `view` parameter is provided `Diff` is displayed in NotePad.

### Version test

Run the test by entering the command: 

    Test.bat version
    
Both BDiff and BPatch are called with the `--version` option and both output their current version on the console. You should check that they report the expected version numbers.

### Help test

Run the test by entering the command: 

    Test.bat help

Both BDiff and BPatch are called with the `--help` option and both output their help screen on the console.

## Clean up

To delete all the files generated by running tests run the command:

    Test.bat clean

## Example

Suppose the versions of BDiff and BPatch to be tested are in `C:\Utils` and you want to:

1. check the version of the programs
2. perform the Patch test
3. clear up the generated files.

Assume that `Test.bat` is stored in `D:\BDiff\Test`.

Open a command console then enter the following commands. In the following, items preceded by `>` are the commands you type and any following text represents the output (your output may vary).

    >cd D:\BDiff\Test
    
    >D:
    
    >set BDIFFPATH=C:\Utils
   
    >Test version
    bdiff-0.2.6 02 Aug 2009
    bpatch-0.2.6 02 Aug 2009
    Done
    
    >Test patch
    --- Creating Patch with bdiff ---
    BDiff.exe: loading old file
    BDiff.exe: loading new file
    BDiff.exe: block sorting old file
    BDiff.exe: generating patch
    BDiff.exe: done

    --- Testing Patch file against expected Diff-b fc ---
    Comparing files Patch and DIFF-B
    FC: no differences encountered

    --- Applying Patch with bpatch ---

    --- Testing patched file against original with fc ---
    Comparing files Test2 and TEST3
    FC: no differences encountered

    Done

    >Test clean
    Done
